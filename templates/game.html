{% extends "base.html" %}

{% block title %}ğŸŒ± Eco Game{% endblock %}

{% block content %}
<div class="container text-center my-5">
    <h2 class="mb-4">ğŸ® Welcome to the Eco Game, {{ current_user.name }}!</h2>
    <p class="text-muted">Click the tree to plant more and earn <strong>Green Coins</strong> ğŸª™</p>

    <!-- Display Coins -->
    <div class="my-3">
        <span class="badge bg-warning text-dark fs-5">
            ğŸŒ Green Coins: <span id="coin-count">{{ current_user.green_coins or 0 }}</span>
        </span>
    </div>

    <!-- Game Area -->
    <div class="game-area d-flex justify-content-center align-items-center mt-4">
        <img src="https://img.icons8.com/emoji/256/deciduous-tree.png"
             id="tree"
             alt="Tree"
             class="clickable-tree shadow-lg"
             width="200">
    </div>

    <p class="mt-3 text-success" id="message"></p>

    <!-- Save Progress -->
    <form id="coin-form" method="POST" action="{{ url_for('mini_game_add_points') }}">
        <!-- CSRF token if using Flask-WTF -->
        {% if form %}
            {{ form.hidden_tag() }}
        {% endif %}
        <input type="hidden" name="coins" id="coins-input" value="{{ current_user.green_coins or 0 }}">
        <button type="submit" class="btn btn-success mt-4 px-4">
            ğŸ’¾ Save Progress
        </button>
    </form>
</div>

<style>
    .clickable-tree {
        cursor: pointer;
        transition: transform 0.12s ease;
    }
    .clickable-tree:active {
        transform: scale(1.08);
    }
</style>

<script>
    // Initialize coins safely
    let coins = parseInt("{{ current_user.green_coins or 0 }}", 10) || 0;
    const tree = document.getElementById("tree");
    const coinCount = document.getElementById("coin-count");
    const message = document.getElementById("message");
    const coinsInput = document.getElementById("coins-input");

    // Game logic: click to earn coins
    tree.addEventListener("click", () => {
        coins++;
        coinCount.textContent = coins;
        coinsInput.value = coins;  // sync hidden input
        message.textContent = "+1 Green Coin ğŸŒ±";
        setTimeout(() => message.textContent = "", 700);
    });

    // Ensure latest coins are sent when saving
    document.getElementById("coin-form").addEventListener("submit", () => {
        coinsInput.value = coins;
    });
</script>
{% endblock %}

